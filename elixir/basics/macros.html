
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Macros Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="errors.html" />
    

        <style media="screen">
        @import url('https://fonts.googleapis.com/css?family=Fira+Mono');
          code, pre, pre code {
            font-family: "Fira Code", "Fira Mono", "Courier New", monospace !important;
          }
          pre code {
            font-size: 0.95em !important;
          }
        </style>
    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Syntax
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Basics</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="variables.html">
            
                <a href="variables.html">
            
                    
                    Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="types.html">
            
                <a href="types.html">
            
                    
                    Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="operators.html">
            
                <a href="operators.html">
            
                    
                    Operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="control-flow.html">
            
                <a href="control-flow.html">
            
                    
                    Control flow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="functions.html">
            
                <a href="functions.html">
            
                    
                    Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="modules.html">
            
                <a href="modules.html">
            
                    
                    Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="protocols.html">
            
                <a href="protocols.html">
            
                    
                    Protocols
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="behaviours.html">
            
                <a href="behaviours.html">
            
                    
                    Behaviours
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="errors.html">
            
                <a href="errors.html">
            
                    
                    Errors
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Advanced</li>
        
        
    
        <li class="chapter active" data-level="3.1" data-path="macros.html">
            
                <a href="macros.html">
            
                    
                    Macros
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>
    <li>
       <a href="../">
         <i class="fa fa-chevron-left" style="margin-right: 3px"></i>
           Back
       </a>
   </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Macros</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="macros">Macros</h1>
<h2 id="abstract-syntax-tree">Abstract Syntax Tree</h2>
<p>Macros in Elixir enable metaprogramming. All Elixir code is represented internally by the abstract syntax tree (AST). Metaprogramming is all about manipulating and inspecting the AST. It is possible to access the AST representation of any Elixir expression using the <code>quote</code> macro.</p>
<p>Elixir code is represented by three-element tuples:</p>
<ul>
<li>The first is an atom with the function call.</li>
<li>The second is metadata about the expression.</li>
<li>The third is a list of arguments for the function call.</li>
</ul>
<p>Literals are represented in AST as themselves: atom, integers, floats, binaries, lists (including keyword lists) and two-element tuples only.</p>
<pre><code class="lang-elixir"><span class="hljs-keyword">quote</span> <span class="hljs-symbol">do:</span> <span class="hljs-number">1</span> + <span class="hljs-number">2</span>
<span class="hljs-comment">#=&gt; {:+, [context: Elixir, import: Kernel], [1, 2]}</span>
</code></pre>
<h2 id="creating-macros">Creating macros</h2>
<p><code>defmacro</code> is used to create a macro and they must be defined inside modules. Parameters passed to a macro are not evaluated, instead they are passed as the AST representation. Macros take in an AST representation and give back an AST representation.</p>
<pre><code class="lang-elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">Kernel</span></span> <span class="hljs-keyword">do</span>
  <span class="hljs-function"><span class="hljs-keyword">defmacro</span> <span class="hljs-title">unless</span></span>(condition, <span class="hljs-symbol">do:</span> clause) <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">quote</span> <span class="hljs-keyword">do</span>
      if unquote(condition), <span class="hljs-symbol">do:</span> <span class="hljs-keyword">nil</span>, <span class="hljs-symbol">else:</span> unquote(clause)
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>The <code>require</code> function tells Elixir to ensure the module with the macro definition is compiled before the module using that macro. Passing the <code>bind_quoted</code> option to the <code>quote</code> macro will ensure outside bound variables are unquoted only a single time.</p>
<pre><code class="lang-elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">Example</span></span> <span class="hljs-keyword">do</span>
  <span class="hljs-function"><span class="hljs-keyword">defmacro</span> <span class="hljs-title">double_puts</span></span>(expression) <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">quote</span> <span class="hljs-symbol">bind_quoted:</span> [<span class="hljs-symbol">expr:</span> expression] <span class="hljs-keyword">do</span>
      IO.puts expression
      IO.puts expression
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

require Example
Example.double_puts(<span class="hljs-symbol">:os</span>.system_time)
<span class="hljs-comment">#=&gt; 1480870512774237000</span>
<span class="hljs-comment">#=&gt; 1480870512774237000</span>
</code></pre>
<p>It is possible to extend a module with the function <a href="elixir/2016/11/15/syntax.html#use"><code>use/2</code></a> adding <code>use ModuleName</code>, which invokes the <code>ModuleName.__using__/1</code> macro.</p>
<h2 id="useful-functions-and-macros">Useful functions and macros</h2>
<p><strong><code>Code.eval_quoted(quoted, binding \\ [], opts \\ [])</code></strong></p>
<p>Evaluates the quoted contents. The <code>binding</code> argument is a keyword list of variable bindings. The opts argument is a keyword list of environment options.</p>
<p><strong><code>Kernel.var!(var, context \\ nil)</code></strong></p>
<p>When used inside quoting, marks that the given variable should not be hygienized.</p>
<p>The argument can be either a variable unquoted or in standard tuple form {name, meta, context}.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="errors.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Errors">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Macros","level":"3.1","depth":1,"previous":{"title":"Errors","level":"2.9","depth":1,"path":"errors.md","ref":"errors.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"fontsettings":{"theme":"night","family":"sans","size":2},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","structure.readme":"variables.md","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"macros.md","mtime":"2016-12-09T02:23:53.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2016-12-09T04:25:55.242Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

